//Data & Sound Sources
var myData = require("characters");
var r2D2Sound = require("r2D2Sound");
var backSoundR2D2 = require("backSoundR2D2");

//List Window
var listWindow = Ti.UI.createWindow({
	backgroundColor: "fff",
	title:"List",
	modal: true
});

//Table Nav

var listNavWindow = Ti.UI.iOS.createNavigationWindow({
	window: listWindow
});

//List View
var listView = Ti.UI.createListView({
	title: "List",
	top: 20
});

//List Sections
var sections = [];

for (n in myData.myCharacters) {
	
	var listSection = Ti.UI.createListSection({
			headerTitle: myData.myCharacters[n].name,
			footerTitle: myData.myCharacters[n].description
		});
	var listSectionItem = [];
	for (var i = 0, j = myData.myCharacters[n].weapons.length; i < j; i++){
		listSectionItem.push({
			properties: {
				title: myData.myCharacters[n].weapons[i].title, 
				accessoryType: Ti.UI.LIST_ACCESSORY_TYPE_DETAIL,
				itemId: myData.myCharacters[n].weapons[i].title + "/" + myData.myCharacters[n].weapons[i].description
			}
		});
		listSection.setItems(listSectionItem);
	};
	sections.push(listSection);
};
listView.addEventListener("itemclick", function(e) {
	//alert("test");
	console.log(e.itemIndex);
	var item = e.itemId.split("/");
	
	var test = Ti.UI.createWindow({
		title: item[0],
		backgroundColor: "#555"
	});
	
	var testLabel = Ti.UI.createLabel({
		text: item[1]
	});
	
	test.add(testLabel);
	listNavWindow.openWindow(test);
	
});

//Buttons
var backButton = Ti.UI.createButton({ 
	backgroundColor: "#0D0D0D",
	bottom: 35,
	width: 85,
	borderRadius: 10,
	title: "BACK"
});

//Event Listeners
backButton.addEventListener("click", function(){
	listNavWindow.close();
	r2D2Sound.stop();
	backSoundR2D2.play();
});

listButton.addEventListener("click", function(){
	listNavWindow.open();
	openingSound.stop();
	backSoundR2D2.stop();
	r2D2Sound.play();
});

listView.sections = sections;

listWindow.add(listView, backButton);
